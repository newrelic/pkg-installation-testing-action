FROM amazonlinux:2023

# Install system updates first
RUN dnf -y update && dnf -y clean all

# Install required packages including Java
RUN dnf -y install \
    python3 \
    python3-pip \
    sudo \
    shadow-utils \
    curl \
    java-11-amazon-corretto-headless \
    && dnf -y clean all

# Verify Java installation
RUN java -version

# Install fake systemctl
RUN curl -fsSL https://raw.githubusercontent.com/gdraheim/docker-systemctl-replacement/master/files/docker/systemctl3.py -o /usr/local/bin/systemctl \
    && chmod +x /usr/local/bin/systemctl

# Set up Python symlink for compatibility
RUN ln -sf /usr/bin/python3 /usr/bin/python

CMD ["/usr/local/bin/systemctl"]
